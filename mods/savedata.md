# Сохранение данных

Практически любой мод рано или поздно столкнется с необходимостью сохранять данные на компьютере пользователя. Это могут быть настройки конфигурации или другие пользовательские параметры. Geode предоставляет встроенную поддержку **двух видов сохранения данных**: **настраиваемые пользователем настройки** и **нередактируемые сохраненные значения**.

Настройки описаны [в отдельном руководстве](/mods/settings.md). **Это же руководство посвящено нередактируемым сохраненным данным.**.

В отличие от настроек, сохраненные значения не нужно объявлять ни в `mod.json`, ни где-либо еще. Они создаются автоматически при первом сохранении значения. Как следует из названия, эти данные сохраняются при закрытии игры и восстанавливаются при следующем запуске.

Вы можете сохранить значение любого типа, если этот тип реализует `matjson::Serialize` (пример можно посмотреть в [реализациях для контейнеров STL](https://github.com/geode-sdk/json/blob/main/include/matjson/stl_serialize.hpp)).

## Запись и чтение сохраненных данных

Для сохранения значений используется метод [setSavedValue](/classes/geode/Mod#setSavedValue)

```cpp
Mod::get()->setSavedValue<float>("my-saved-value", .5f);
Mod::get()->setSavedValue<std::string>("my-other-value", "Garlagan!!!");

struct MyCustomSaveData {
    int x;
    int y;
};

template<>
struct matjson::Serialize<MyCustomSaveData> {
    static MyCustomSaveData from_json(matjson::Value const& value) {
        return MyCustomSaveData {
            .x = value["x"].as_int(),
            .y = value["y"].as_int()
        };
    }

    static matjson::Value to_json(MyCustomSaveData const& value) {
        auto obj = matjson::Object();
        obj["x"] = value.x;
        obj["y"] = value.y;
        return obj;
    }
};

Mod::get()->setSavedValue("data", MyCustomSaveData { .x = 5, .y = 2 });
```

Аналогично, для получения сохраненного значения используется метод [getSavedValue](/classes/geode/Mod#getSavedValue). Если значение еще не было сохранено, можно явно указать значение по умолчанию, иначе будет использован конструктор по умолчанию типа данных:

```cpp
auto value = Mod::get()->getSavedValue<float>("my-saved-value");
auto data = Mod::get()->getSavedValue<MyCustomSaveData>("data", MyCustomSaveData { .x = 0, .y = 0 });
```

Небольшой полезный совет: `setSavedValue` возвращает предыдущее сохраненное значение или, если его нет, создает его значением по умолчанию и возвращает. Зная, что конструктор по умолчанию для `bool` возвращает false, вы можете использовать это, чтобы показывать всплывающие окна с информацией только один раз:
```cpp
if (!Mod::get()->setSavedValue("shown-upload-guidelines", true)) {
    FLAlertLayer::create(
        "Правила загрузки",
        "Разрешено публиковать только изображения милых девушек-кошек",
        "OK"
    )->show();
}
```

Это всплывающее окно будет показано только один раз при первом запуске кода и больше никогда не появится.

## Сохранение других данных

Моды должны сохранять другие данные (файлы, резервные копии и т.д.) в свою собственную папку сохранения, доступ к которой можно получить с помощью метода `Mod::get()->getSaveDir()`. Использование предоставленных Geode каталогов гарантирует, что при удалении мода Geode сможет корректно удалить все связанные с ним данные. Кроме того, предоставленные Geode каталоги гарантированно доступны для чтения и записи на всех платформах.

Стоит отметить, что у мода могут быть веские причины сохранять данные в другом месте. Например, мод, который сохраняет созданные уровни в виде отдельных файлов, а не в CCLocalLevels, может обоснованно сохранять их непосредственно в папку сохранения Geometry Dash, поскольку эти данные не связаны напрямую с самим модом.

Если у вас есть данные, которые пользователь должен иметь возможность редактировать (например, файлы конфигурации), они должны находиться в папке, предоставленной методом `Mod::get()->getConfigDir()`.  **Не захламляйте основную папку Geometry Dash файлами конфигурации или сохраненными данными**. Это почти наверняка приведет к отклонению вашего мода из индекса, если у вас нет _очень_ веской причины для этого!
